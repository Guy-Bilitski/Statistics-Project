---
title: "Test2 & Test3 United"
author: "me"
date: "31 5 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Tests 2 & 3

```{r}
path2 <- "Knessets.csv"
Knessets <- read.delim(file = path2, header=TRUE, sep = ',')

# Calculates the size of Knesset members in Coalition, among Small Factions,
# in the specified Knesset number.
# Small Factions defined to be factions with 7 mandates or less.
smallInCoalition_PartiesSize <- function(kns.num){
  A <- Knessets[Knessets$Knesset == kns.num, ]
  x <- A$SmallParty == 'V' & A$Coalition == 'V'
  sum(A$Mandates[x])
}

# Calculates the size of Knesset members in *Knesset*, among Small Factions,
# in the specified Knesset number.
# Small Factions defined to be factions with 7 mandates or less.
smallInKneset <- function(kns.num){
  A <- Knessets[Knessets$Knesset == kns.num, ]
  x <- A$SmallParty == 'V'
  sum(A$Mandates[x])
}


smallCount_InCoalition <- sapply(c(1:24), smallInCoalition_PartiesSize)

smallCount_InKnesset <- sapply(c(1:24), smallInKneset)

smallRate_OutOfCoalition <- smallCount_InCoalition / smallCount_InKnesset

```


\

**An important notion - 'Small Factions Bloc': The Group of all Knesset members who are identified with a small sized party (7 mandates or less).**

\

\newpage

## Test 2 - Small Factions Bloc size

\
```{r}
boxplot(smallCount_InKnesset[1:20],
        smallCount_InKnesset[21:24],
        main = 'התפלגות מספר חברי המפלגות הקטנות מתוך הכנסת (2)', ylab = 'Knesset Members',
        names = c("Eearly Knessets", "Late Knessets"))
```

\

\newpage


```{r}
plot(smallCount_InKnesset, xlab = 'Knessets', 
                      ylab = 'Small Factions in size in Knesset')


resid <- lm(smallCount_InKnesset ~ c(1:24))
abline(resid, col = 'yellow')
```

```{r, fig.width=3, fig.height=3}
plot(resid$residuals ~ c(1:24), main = "Residuals Plot of Test 2")
abline(0,0)
```

\newpage

Wilcoxon Rank Sum test for size mean:
```{r}
kns_1.to.20 <- smallCount_InKnesset[1:20]
kns_21.to.24 <- smallCount_InKnesset[21:24]

wilcox.test(x = kns_1.to.20, y = kns_21.to.24, alternative = "less",
            mu = 0, conf.level = 0.95, exact = F)


all_permutations<- combn(rank(c(kns_1.to.20, kns_21.to.24)), 4)
w_null2 <- apply(all_permutations, 2, sum)
qqnorm(w_null2, main = "Normal Q-Q Plot - Test 2")
```

\

\newpage

## Test 3 - Rate between Knesset members in Coalition, out of the Small Factions Bloc, to Knesset members in General


\

```{r}
coalitionSize <- function(kns.num){
  A <- Knessets[Knessets$Knesset == kns.num, ]
  x <- A$Coalition == 'V'
  sum(A$Mandates[x])
}

coalition_Sizes <- sapply(c(1:24), coalitionSize)

smallRate_New <- smallCount_InCoalition / coalition_Sizes
```

\

\newpage


```{r}
boxplot(smallRate_New[1:20], smallRate_New[21:24],
        main = 'התפלגות פרופורציית גודל המפלגות הקטנות מתוך הקואליציה (3)',
        names = c("Early Knessets", "Late Knessets"), ylab ='Proportions')
#points(c(mean(smallRate_New[1:20]),mean(smallRate_New[21:24])), pch = 2, col = 2)
```

\

\newpage

```{r}
plot(smallRate_New ~ c(1:24), xlab = 'Knessets', 
                      ylab = 'Rate')


resid <- lm(smallRate_New ~ c(1:24))
abline(resid, col = 'yellow')
```

```{r, fig.width=3, fig.height=3}
plot(resid$residuals ~ c(1:24), main = "Residuals Plot of Test 4")
abline(0,0)
```

\newpage

Wilcoxon Rank Sum test for proportion diff:
```{r}
kns_1.to.20 <- smallRate_New[1:20]
kns_21.to.24 <- smallRate_New[21:24]

wilcox.test(x = kns_1.to.20, y = kns_21.to.24, alternative = "less",
            mu = 0, conf.level = 0.95, exact = F)

all_permutations <- combn(rank(c(kns_1.to.20, kns_21.to.24)), 4)
w_null3 <- apply(all_permutations, 2, sum)
qqnorm(w_null3, main = "Normal Q-Q Plot - Test 3")
```
